<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <description>Calls Qualtrics to add/update contact.</description>
        <name>QualtricsCallout_0_0</name>
        <label>QualtricsCallout</label>
        <locationX>50</locationX>
        <locationY>1763</locationY>
        <actionName>Contact.QualtricsCallout</actionName>
        <actionType>outboundMessage</actionType>
        <faultConnector>
            <targetReference>QualtricsFailed_0</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
    </actionCalls>
    <actionCalls>
        <name>QualtricsFailed_0</name>
        <label>Qualtrics Failed</label>
        <locationX>314</locationX>
        <locationY>1871</locationY>
        <actionName>emailSimple</actionName>
        <actionType>emailSimple</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>emailBody</name>
            <value>
                <stringValue>Qualtrics Failed {!$Flow.CurrentDateTime}</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailAddressesArray</name>
        </inputParameters>
        <inputParameters>
            <name>emailAddresses</name>
            <value>
                <stringValue>matthew.samson@adyen.com</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>emailSubject</name>
            <value>
                <stringValue>QF - {!$Flow.CurrentDateTime}</stringValue>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>SendCustomNotificationNewContact</name>
        <label>Send Custom Notification</label>
        <locationX>182</locationX>
        <locationY>1463</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>Add_to_Qualtrics_0_0</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>GetCustomNotificationNewContact.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>txtNotificationBodyNewContact</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <elementReference>txtNotificationTitleNewContact</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>collectionRecipientNewContact</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <actionCalls>
        <name>SendNotification</name>
        <label>Send Notification</label>
        <locationX>182</locationX>
        <locationY>947</locationY>
        <actionName>customNotificationAction</actionName>
        <actionType>customNotificationAction</actionType>
        <connector>
            <targetReference>NewContactOnAccount</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>customNotifTypeId</name>
            <value>
                <elementReference>GetCustomNotification.Id</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>textMessageToReferralContactOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>Partner Referral Contact Owner updated on Contact</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>recipientIds</name>
            <value>
                <elementReference>collectionRecipientReferralContactOwner</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>targetId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>51.0</apiVersion>
    <assignments>
        <name>AssignRecipientNewContact</name>
        <label>Assign Recipient</label>
        <locationX>182</locationX>
        <locationY>1355</locationY>
        <assignmentItems>
            <assignToReference>collectionRecipientNewContact</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record.Account.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SendCustomNotificationNewContact</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignRecipientReferralContactOwner</name>
        <label>Assign Recipient</label>
        <locationX>182</locationX>
        <locationY>839</locationY>
        <assignmentItems>
            <assignToReference>collectionRecipientReferralContactOwner</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>$Record__Prior.PartnerReferralContactOwner__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>SendNotification</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Add_to_Qualtrics_0_0</name>
        <label>Add to Qualtrics</label>
        <locationX>314</locationX>
        <locationY>1655</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Qualtrics_Callout_0_0</name>
            <conditionLogic>(1 OR 2)</conditionLogic>
            <conditions>
                <leftValueReference>IsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>QualtricsFieldsUpdated</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>QualtricsCallout_0_0</targetReference>
            </connector>
            <label>Qualtrics Callout</label>
        </rules>
    </decisions>
    <decisions>
        <name>IsNewContact</name>
        <label>IsNewContact?</label>
        <locationX>314</locationX>
        <locationY>323</locationY>
        <defaultConnector>
            <targetReference>NewPartnerReferralContactOwner</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record__Prior.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.ConvertedFromLead__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Preferred_Language</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <description>Send notification to Account owner when a lead is converted into a new contact with a different owner. Contacts created by Leandata are excluded as these are merged into existing contacts.</description>
        <name>NewContactOnAccount</name>
        <label>NewContactOnAccount?</label>
        <locationX>314</locationX>
        <locationY>1139</locationY>
        <defaultConnector>
            <targetReference>Add_to_Qualtrics_0_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No Action Required</defaultConnectorLabel>
        <rules>
            <name>OtherAccountOwner</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Owner.Id</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Account.Owner.Id</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Account.Owner.Id</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Label.UnmanagedUser</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>IsNew</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Account.Owner.IsActive</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetCustomNotificationNewContact</targetReference>
            </connector>
            <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
            <label>Other Account Owner</label>
        </rules>
    </decisions>
    <decisions>
        <name>NewPartnerReferralContactOwner</name>
        <label>New Partner Referral Contact Owner?</label>
        <locationX>314</locationX>
        <locationY>623</locationY>
        <defaultConnector>
            <targetReference>NewContactOnAccount</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesPartnerReferralContactOwnerChanged</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.PartnerReferralContactOwner__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.PartnerReferralContactOwner__r.IsActive</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record__Prior.PartnerReferralContactOwner__r.Id</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>forLoggedInUser</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetCustomNotification</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>25/09/23 Removed non used components.</description>
    <environments>Default</environments>
    <formulas>
        <name>forLoggedInUser</name>
        <dataType>String</dataType>
        <expression>CASESAFEID({!$User.Id})</expression>
    </formulas>
    <formulas>
        <name>forPreferredLanguage</name>
        <dataType>String</dataType>
        <expression>IF(NOT(ISBLANK({!$Record.MailingCountry})),
CASE({!$Record.MailingCountry},
&apos;Japan&apos;, &apos;Japanese&apos;,
&apos;France&apos;, &apos;French&apos;,
&apos;Germany&apos;, &apos;German&apos;,
&apos;Switzerland&apos;, &apos;German&apos;,
&apos;Austria&apos;, &apos;German&apos;,
&apos;Italy&apos;, &apos;Italian&apos;,
&apos;Brazil&apos;, &apos;Portuguese&apos;,
&apos;Mexico&apos;, &apos;Spanish&apos;,
&apos;Sweden&apos;, &apos;Swedish&apos;,
&apos;Denmark&apos;, &apos;Danish&apos;,
&apos;Norway&apos;, &apos;Norwegian&apos;,
&apos;Poland&apos;, &apos;Polish&apos;,
&apos;Portugal&apos;, &apos;Portuguese&apos;,
&apos;Netherlands&apos;, &apos;Dutch&apos;,
&apos;Spain&apos;, &apos;Spanish&apos;,
&apos;English&apos;),
&apos;English&apos;)</expression>
    </formulas>
    <formulas>
        <name>IsNew</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <formulas>
        <name>QualtricsFieldsUpdated</name>
        <dataType>Boolean</dataType>
        <expression>OR(ISCHANGED({!$Record.Department__c}),ISCHANGED({!$Record.FirstName}),ISCHANGED({!$Record.LastName}),ISCHANGED({!$Record.Email}),ISCHANGED({!$Record.Level__c}),ISCHANGED({!$Record.Title}),ISCHANGED({!$Record.AccountId}),ISCHANGED({!$Record.QualtricsSync__c}))</expression>
    </formulas>
    <interviewLabel>After {!$Flow.CurrentDateTime}</interviewLabel>
    <label>After-Save Updates Contact</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>GetCustomNotification</name>
        <label>Get Custom Notification</label>
        <locationX>182</locationX>
        <locationY>731</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AssignRecipientReferralContactOwner</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>ReferralContactOwnerNotification</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CustomNotificationType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetCustomNotificationNewContact</name>
        <label>Get Custom Notification</label>
        <locationX>182</locationX>
        <locationY>1247</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AssignRecipientNewContact</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>NewContact</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CustomNotificationType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Preferred_Language</name>
        <label>Update Preferred Language</label>
        <locationX>182</locationX>
        <locationY>431</locationY>
        <connector>
            <targetReference>NewPartnerReferralContactOwner</targetReference>
        </connector>
        <inputAssignments>
            <field>Preferred_Language__c</field>
            <value>
                <elementReference>forPreferredLanguage</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>188</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>IsNewContact</targetReference>
        </connector>
        <object>Contact</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>textMessageToReferralContactOwner</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$User.FirstName} {!$User.LastName} changed the Partner Referral Contact Owner on a Contact where you were previously the Partner Referral Contact Owner: {!$Record.FirstName} {!$Record.LastName}</text>
    </textTemplates>
    <textTemplates>
        <name>txtNotificationBodyNewContact</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>{!$Record.FirstName} {!$Record.LastName} has been added as Contact. Click on this notification to open the Contact record.</text>
    </textTemplates>
    <textTemplates>
        <name>txtNotificationTitleNewContact</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>A new Contact has been added to an Account you own: {!$Record.Account.Name}</text>
    </textTemplates>
    <variables>
        <name>collectionRecipientNewContact</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>collectionRecipientReferralContactOwner</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
