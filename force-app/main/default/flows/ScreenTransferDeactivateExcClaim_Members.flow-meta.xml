<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>52.0</apiVersion>
    <choices>
        <name>choDeactivateClaimMember</name>
        <choiceText>Deactivate this Claim Member (Duplicate)</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Deactivate</stringValue>
        </value>
    </choices>
    <choices>
        <name>choTransferClaimMember</name>
        <choiceText>Transfer Claim Member to other Exception Claim</choiceText>
        <dataType>String</dataType>
        <value>
            <stringValue>Transfer</stringValue>
        </value>
    </choices>
    <decisions>
        <name>RecordsFound</name>
        <label>Records Found?</label>
        <locationX>578</locationX>
        <locationY>278</locationY>
        <defaultConnector>
            <targetReference>scrIntroScreen1</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>YesRecordsFound</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetSimilarExceptionClaimMembers</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>scrIntroScreen0</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
        <rules>
            <name>NoInApprovalApproved</name>
            <conditionLogic>1 AND (2 OR 3 OR 4)</conditionLogic>
            <conditions>
                <leftValueReference>GetSimilarExceptionClaimMembers</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>recordId.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Pending</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>recordId.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Submitted</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>recordId.Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Approved</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>scrNoValidActions</targetReference>
            </connector>
            <label>No &amp; In Approval/Approved</label>
        </rules>
    </decisions>
    <decisions>
        <name>TransferOrDeactivate</name>
        <label>Transfer Or Deactivate?</label>
        <locationX>578</locationX>
        <locationY>1070</locationY>
        <defaultConnector>
            <targetReference>UpdateStatusCurrentClaimMember</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Deactivate</defaultConnectorLabel>
        <rules>
            <name>TransferWasChosen</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>inputActionWithTransfer</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Transfer</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>UpdateClaimCurrentClaimMember</targetReference>
            </connector>
            <label>Transfer</label>
        </rules>
    </decisions>
    <decisions>
        <name>WhatAction</name>
        <label>What Action?</label>
        <locationX>292</locationX>
        <locationY>518</locationY>
        <defaultConnector>
            <targetReference>scrSummaryScreen</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Deactivate</defaultConnectorLabel>
        <rules>
            <name>Transfer</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>inputActionWithTransfer</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Transfer</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>scrActionScreen</targetReference>
            </connector>
            <label>Transfer</label>
        </rules>
    </decisions>
    <description>Latest Update: Added Error Handling</description>
    <dynamicChoiceSets>
        <name>choExceptionClaims</name>
        <dataType>String</dataType>
        <displayField>ClaimName__c</displayField>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Account__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.Account__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>User__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.User__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.RecordTypeId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>recordId.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Claim__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Pending</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Submitted</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Inactive</stringValue>
            </value>
        </filters>
        <object>ClaimMembers__c</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <valueField>Claim__c</valueField>
    </dynamicChoiceSets>
    <interviewLabel>Screen - Transfer/Deactivate Exc. Claim Members {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Screen - Transfer/Deactivate Exc. Claim Members</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordLookups>
        <name>GetOtherClaimMemberOnNewClaim</name>
        <label>Get Other Claim Member on New Claim</label>
        <locationX>50</locationX>
        <locationY>1310</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>UpdateOtherClaimMember</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>ErrorScreen</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Claim__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>inputNewClaim</elementReference>
            </value>
        </filters>
        <filters>
            <field>User__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.User__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.RecordTypeId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Account__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.Account__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Submitted</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Pending</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>ClaimMembers__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetSimilarExceptionClaimMembers</name>
        <label>Get Similar Exception Claim Members</label>
        <locationX>578</locationX>
        <locationY>158</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>RecordsFound</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>ErrorScreen</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>User__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.User__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>Account__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.Account__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>RecordTypeId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.RecordTypeId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>recordId.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Claim__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Submitted</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Pending</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Inactive</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ClaimMembers__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>UpdateClaimCurrentClaimMember</name>
        <label>Update Claim Current Claim Member</label>
        <locationX>50</locationX>
        <locationY>1190</locationY>
        <connector>
            <targetReference>GetOtherClaimMemberOnNewClaim</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>ErrorScreen</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Claim__c</field>
            <value>
                <elementReference>inputNewClaim</elementReference>
            </value>
        </inputAssignments>
        <object>ClaimMembers__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>UpdateOtherClaimMember</name>
        <label>Update Other Claim Member</label>
        <locationX>50</locationX>
        <locationY>1430</locationY>
        <faultConnector>
            <targetReference>ErrorScreen</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GetOtherClaimMemberOnNewClaim.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Claim__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Inactive</stringValue>
            </value>
        </inputAssignments>
        <object>ClaimMembers__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>UpdateStatusCurrentClaimMember</name>
        <label>Update Status Current Claim Member</label>
        <locationX>1106</locationX>
        <locationY>1190</locationY>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>ErrorScreen</targetReference>
        </faultConnector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Claim__c</field>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Inactive</stringValue>
            </value>
        </inputAssignments>
        <object>ClaimMembers__c</object>
    </recordUpdates>
    <screens>
        <name>ErrorScreen</name>
        <label>ErrorScreen</label>
        <locationX>314</locationX>
        <locationY>1550</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>disErrorText</name>
            <fieldText>&lt;p&gt;&lt;b&gt;Something went wrong during this process due to the following error:&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255); color: rgb(192, 1, 1);&quot;&gt;{!$Flow.FaultMessage}&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Please retry if you understand what goes wrong, otherwise reach out to your System Administrator.&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scrActionScreen</name>
        <label>Action Screen</label>
        <locationX>160</locationX>
        <locationY>638</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>scrSummaryScreen</targetReference>
        </connector>
        <fields>
            <name>disExplanationTransfer_0</name>
            <fieldText>&lt;p&gt;&lt;b style=&quot;font-size: 14px;&quot;&gt;Attention&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Please note that the Claim Member that already exists for this user on the selected Claim will be set to the status &apos;Inactive&apos;.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;An Exception Claim without Claim Members or with only inactive Claim Members will also adopt the &apos;Inactive&apos; status.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>inputNewClaim</name>
            <choiceReferences>choExceptionClaims</choiceReferences>
            <dataType>String</dataType>
            <fieldText>What should be the new Exception Claim for this Claim Member?</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scrIntroScreen0</name>
        <label>Intro Screen</label>
        <locationX>292</locationX>
        <locationY>398</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>WhatAction</targetReference>
        </connector>
        <fields>
            <name>inputActionWithTransfer</name>
            <choiceReferences>choTransferClaimMember</choiceReferences>
            <choiceReferences>choDeactivateClaimMember</choiceReferences>
            <dataType>String</dataType>
            <fieldText>What action do you want to perform?</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scrIntroScreen1</name>
        <label>Intro Screen</label>
        <locationX>864</locationX>
        <locationY>398</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>scrSummaryScreen</targetReference>
        </connector>
        <fields>
            <name>disExplanationDeactivation</name>
            <fieldText>&lt;p&gt;&lt;b&gt;No other valid Exception Claims were found, therefore you cannot transfer this Claim Member to another Exception Claim. A valid Exception Claim is one where:&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The User &amp;amp; Account are similar to the current Claim Member&lt;/li&gt;&lt;li&gt;The other Claim Member is not yet pending, submitted, approved or inactive&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>inputAcountWithoutTransfer</name>
            <choiceReferences>choDeactivateClaimMember</choiceReferences>
            <dataType>String</dataType>
            <fieldText>What action do you want to perform?</fieldText>
            <fieldType>RadioButtons</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scrNoValidActions</name>
        <label>No Valid Actions Screen</label>
        <locationX>600</locationX>
        <locationY>398</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <fields>
            <name>disExplanationTransfer</name>
            <fieldText>&lt;p&gt;&lt;b&gt;No other valid Exception Claims were found, therefore you cannot transfer this Claim Member to another Exception Claim. A valid Exception Claim is one where:&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The User &amp;amp; Account are similar to the current Claim Member&lt;/li&gt;&lt;li&gt;The other Claim Member is not yet pending, submitted, approved or inactive&lt;/li&gt;&lt;/ul&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>disExplanationDeactivation1</name>
            <fieldText>&lt;p&gt;&lt;b&gt;Claim Member cannot be deactivated&lt;/b&gt;&lt;/p&gt;&lt;p&gt;This Claim Member cannot be deactivated as it&apos;s already sent for approval and there is no other Exception Claim Member for this user on the Account. Instead of deactivating, reject the approval process.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>disClickOnFinish</name>
            <fieldText>&lt;p style=&quot;text-align: right;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;text-align: right;&quot;&gt;&lt;b&gt;Click on Finish to end this flow.&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <screens>
        <name>scrSummaryScreen</name>
        <label>Summary Screen</label>
        <locationX>578</locationX>
        <locationY>950</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>TransferOrDeactivate</targetReference>
        </connector>
        <fields>
            <name>disSummary</name>
            <fieldText>&lt;p&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;Summary&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>disPerformTransfer</name>
            <fieldText>&lt;p&gt;You have chosen to perform a transfer of this Claim Member to a different Exception Claim. The Claim Member for this same user that already exists on the other Exception Claim will be set to status &apos;Inactive&apos; and its link to the Claim will be removed. Additionally, if there are no active Claim Members left on the current Exception Claim, this Claim record will also adopt the status &apos;Inactive&apos;.&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>inputActionWithTransfer</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>Transfer</stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>disDeduplicate</name>
            <fieldText>&lt;p&gt;You have chosen to deactivate the current Claim Member. The Claim Member will receive the status &apos;Inactive&apos; and will be unlinked from the Claim. Additionally, when there are no active Claim Members left on the current Exception Claim, the Claim will also adopt the &apos;Inactive&apos; status&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>or</conditionLogic>
                <conditions>
                    <leftValueReference>inputActionWithTransfer</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>Deactivate</stringValue>
                    </rightValue>
                </conditions>
                <conditions>
                    <leftValueReference>inputAcountWithoutTransfer</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>Deactivate</stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>disClickOnNext</name>
            <fieldText>&lt;p style=&quot;text-align: right;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;text-align: right;&quot;&gt;&lt;b&gt;Click on Next to continue with these actions.&lt;/b&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>452</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetSimilarExceptionClaimMembers</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>recordId</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>ClaimMembers__c</objectType>
    </variables>
    <variables>
        <name>varRecordsFound</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
